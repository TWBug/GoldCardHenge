{{ $cover_image := "false" }}
{{ $large := "" }}
{{ $small := "" }}
{{ $buffer := "" }}
{{ with .Params.cover_image }}
{{ if fileExists (printf "assets/%s" ( . | safeURL)) }}
{{ if or (strings.HasSuffix . "png") (strings.HasSuffix . "jpg") }}
{{ $buffer = resources.Get (printf "%s" ( . | safeURL)) }}
{{ end }}
{{ end }}
{{ end }}

{{ if ne $buffer "" }}
{{ $large = $buffer.Fill "672x672 jpg q15" }}
{{ $small = $buffer.Fill "336x336 q15" }}
{{ $cover_image = "true" }}
{{ end }}

{{ $h1_count := .Content | strings.Count "<h1" }}

{{ $h1_count }}

<div class="container py-12 sm:py-24 px-12 lg:px-24">
    {{ if eq $cover_image "true" }}
    <div class="md:hidden relative w-full h-0 pb-full min-h-32 rounded-md shadow-xl overflow-hidden mb-8">
        <figure>
            <img
                srcset="{{ $small.RelPermalink }} 480w, {{ $large.RelPermalink }} 1024w"
                src="{{ $large.RelPermalink | safeURL }}"
                alt="{{ .Page.Params.cover_image_alt | truncate 100 }}"
                class="block absolute inset-0 w-full h-full object-cover"
                loading="lazy"
            />
        </figure>
    </div>
    {{ end }}
    {{ partial "breadcrumb" . }}
    <div id="scroll" class="grid grid-cols-1 md:grid-cols-3 gap-12 xl:gap-24">
        <div class="copy replace sm:col-span-2 pt-4">
            <main>
                {{ if eq $h1_count 0 }}
                <h1 class="text-5xl font-medium leading-tight mb-2">
                    {{ .Title | safeHTML }}
                </h1>
                {{ end }}
                {{.Content}}
            </main>
        </div>
        <div class="print:hidden -mt-8">
            {{ if eq $cover_image "true" }}
            <div class="hidden md:block relative w-full h-0 pb-full min-h-32 rounded-md shadow-xl overflow-hidden mb-8">
                <img
                    srcset="{{ $small.RelPermalink }} 480w, {{ $large.RelPermalink }} 1024w"
                    src="{{ $large.RelPermalink | safeURL }}"
                    alt="{{ .Page.Params.cover_image_alt | truncate 100 }}"
                    class="block absolute inset-0 w-full h-full object-cover"
                    loading="lazy"
                />
            </div>
            {{ end }}
            <div class="print:hidden sm:-mt-4">
                <aside>
                {{ partial "aside/summary" . }}
                {{ partial "aside/toc" . }}
                {{ if .Params.categories }}
                {{ partial "aside/all-categories" . }}
                {{ end }}
                {{ if .Params.tags }}
                {{ partial "aside/all-tags" . }}
                {{ end }}
                {{ if .Params.topics }}
                {{ partial "aside/all-topics" . }}
                {{ end }}
                {{ partial "aside/apply-now" . }}
                </aside>
            </div>
        </div>
    </div>
</div>
